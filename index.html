<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>ELITES +</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.7.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100..900&display=swap" rel="stylesheet">

    <style>
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
            font-family: "Montserrat", sans-serif;
        }

        body {
            width: 100%;
            min-height: 100vh;
            background: linear-gradient(160deg, #f1ab11, #311803);
            background-attachment: fixed;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: linear-gradient(90deg, #111, #484646);
        }

        form {
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
        }

        main {
            padding: 0 10px;
        }

        h1.section-title {
            margin: 20px 0 10px;
            color: #fff;
            font-size: 26px;
            font-weight: 700;
        }

        .library {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 150px));
            gap: 10px;
        }

        .library div {
            position: relative;
            cursor: pointer;
            overflow: hidden;
            transition: transform .3s;
            background: #fff;
            padding: 8px;
            border-radius: 10px;
        }

        .library div:hover {
            transform: scale(1.02);
        }

        .library div img {
            width: 100%;
            border-radius: 5px;
        }

        .library div::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0);
            transition: .3s;
        }

        .library div:hover::before {
            background: rgba(0, 0, 0, .6);
        }

        .library div::after {
            content: 'â–¶';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            color: #fff;
            opacity: 0;
            transition: .3s;
        }

        .library div:hover::after {
            opacity: 1;
        }

        /* Modal */
        #Modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, .8);
            color: #fff;
            overflow-y: auto;
            padding: 20px;
        }

        #Modal .content {
            background: #222;
            margin: auto;
            padding: 20px;
            border-radius: 10px;
            max-width: 500px;
            display: flex;
            gap: 10px;
        }
    </style>
</head>

<body>

    <header>
        <h1 style="color: #fff;">ELITES +</h1>

        <form id="searchForm">
            <input type="text" id="query" placeholder="Search movies or series..."
                style="padding: 10px; border-radius: 20px; border: 1px solid #111; width: 200px; outline: none;">
            <span style="position: absolute; right: 10px; top: 5px;">
                <i class="ri-search-line" style="font-size: 26px; color: #fff;"></i>
            </span>
        </form>
    </header>

    <main>


        <h1 class="section-title">ðŸŽ¬ Movies</h1>
        <div id="moviesLibrary" class="library"></div>

        <h1 class="section-title">ðŸ“º Series</h1>
        <div id="tvLibrary" class="library"></div>

        <!-- Shared modal -->
        <div id="Modal">
            <div class="content">
                <img id="modalPoster" style="max-width: 120px;">
                <div>
                    <h3 id="modalTitle"></h3>
                    <p id="modalOverview"></p>

                    <div style="margin-top: 10px; display: flex; justify-content: end; gap: 20px;">
                        <a id="ModalClose"
                            style="padding: 10px; background: #fff; color: #111; border-radius: 20px; cursor: pointer;">Close</a>
                        <a id="detailsLink"
                            style="padding: 10px; background: #fff; color: #111; border-radius: 20px; cursor: pointer;">Watch</a>
                    </div>
                </div>
            </div>
        </div>

    </main>


    <script>
    // Dynamically choose API base URL
    const API_BASE = "https://eliteplus.pythonanywhere.com";

    const moviesLibrary = document.getElementById('moviesLibrary');
    const tvLibrary = document.getElementById('tvLibrary');
    const queryInput = document.getElementById('query');
    const form = document.getElementById('searchForm');

    const modal = document.getElementById('Modal');
    const modalClose = document.getElementById('ModalClose');
    const modalTitle = document.getElementById('modalTitle');
    const modalPoster = document.getElementById('modalPoster');
    const modalOverview = document.getElementById('modalOverview');
    const detailsLink = document.getElementById('detailsLink');

    // Fetch movies
    async function fetchMovies(query = "") {
        try {
            const url = query 
                ? `${API_BASE}/api/movies?query=${encodeURIComponent(query)}`
                : `${API_BASE}/api/movies`;
            const res = await fetch(url);
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            const data = await res.json();
            renderLibrary(data.movies || [], moviesLibrary, "movie");
        } catch (err) {
            console.error("Error fetching movies:", err);
            moviesLibrary.innerHTML = "<p style='color:#fff;'>Failed to load movies.</p>";
        }
    }

    // Fetch TV shows
    async function fetchTV(query = "") {
        try {
            const url = query 
                ? `${API_BASE}/api/tv?query=${encodeURIComponent(query)}`
                : `${API_BASE}/api/tv`;
            const res = await fetch(url);
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            const data = await res.json();
            renderLibrary(data.tv_shows || [], tvLibrary, "tv");
        } catch (err) {
            console.error("Error fetching TV shows:", err);
            tvLibrary.innerHTML = "<p style='color:#fff;'>Failed to load series.</p>";
        }
    }

    // Render movies or TV shows into grid
    function renderLibrary(items, container, type) {
        container.innerHTML = "";
        items.forEach(item => {
            const div = document.createElement('div');
            div.innerHTML = item.poster 
                ? `<img src="${item.poster}" style="width:100%;border-radius:5px;">` 
                : '';
            div.addEventListener('click', () => showModal(item, type));
            container.appendChild(div);
        });
    }

    // Show modal with movie/series details
    function showModal(item, type) {
        modalTitle.textContent = item.title || item.name;
        modalPoster.src = item.poster || '';
        modalOverview.textContent = item.overview || 'No overview available.';
        detailsLink.href = type === "movie"
            ? `movie.html?id=${item.id}`
            : `series.html?id=${item.id}`;
        modal.style.display = 'flex';
    }

    // Modal close handlers
    modalClose.addEventListener('click', () => modal.style.display = 'none');
    window.addEventListener('click', e => {
        if (e.target == modal) modal.style.display = 'none';
    });

    // Search form
    form.addEventListener('submit', e => {
        e.preventDefault();
        fetchMovies(queryInput.value);
        fetchTV(queryInput.value);
    });

    // Initial load
    fetchMovies();
    fetchTV();
</script>


</body>

</html>