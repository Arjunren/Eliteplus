<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>ELITES +</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.7.0/fonts/remixicon.css" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Montserrat, sans-serif
        }

        body {
            background: #020202;
            color: #fff;
            width: 100%;
            overflow-x: hidden;
        }

        header {
            width: 100%;
            height: 80px;

            background-color: rgba(0, 0, 0, 0.8);
            position: fixed;
            top: 0;
            left: 0;
            z-index: 4;

            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 20px;

            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .Nav-Bar {
            display: flex;
            align-items: center;
            min-height: 70px;
        }

        .Nav-Menu {
            list-style: none;
            display: flex;
            align-items: center;
            width: 100%;

        }

        .Nav-Item {
            margin: 0 1px 0 10px;
        }

        .Nav-Item a {
            position: relative;
            font-size: 20px;
            color: #fff;
            text-decoration: none;
            padding: 5px 10px;
            border-radius: 50px;
            overflow: hidden;
            cursor: pointer;
        }

        .Hamburger {
            display: none;
        }

        .Bar {
            display: block;
            width: 25px;
            height: 3px;
            margin: 5px auto;
            -webkit-transition: all 0.3s ease-out;
            transition: all 0.3s ease-out;
            background-color: #fff;
        }

        @media (max-width: 768px) {

            .Hamburger {
                display: block;
            }

            .Hamburger.active .Bar:nth-child(2) {
                opacity: 0;
            }

            .Hamburger.active .Bar:nth-child(1) {
                transform: translateY(8px) rotate(45deg);
            }

            .Hamburger.active .Bar:nth-child(3) {
                transform: translateY(-8px) rotate(-45deg);
            }

            .Nav-Menu {
                position: fixed;
                left: -100%;
                top: 60px;
                gap: 0;
                flex-direction: column;
                background-color: #111;
                width: 100%;
                height: 100vh;
                text-align: center;
                transition: 0.3s;
            }

            .Nav-Item {
                margin: 16px 0;
            }

            .Nav-Menu.active {
                left: 0;
            }
        }

        .Nav-Item a::after {
            content: "";
            position: absolute;
            left: 20px;
            bottom: 0;
            height: 2px;
            width: 0%;
            background-color: #00eaff;
            transition: width 0.4s ease;
        }

        .Nav-Item a:hover::after {
            width: calc(100% - 40px);
        }

        @keyframes underlineGrow {
            from {
                width: 0;
            }

            to {
                width: calc(100% - 40px);
            }
        }

        .Nav-Item a:hover::after {
            animation: underlineGrow 0.4s ease forwards;
        }

        h2 {
            margin: 20px 0 10px 20px;
            font-size: 24px
        }

        .swiper-slide {
            width: 150px;
            aspect-ratio: 2 / 3;
            cursor: pointer;
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            background: #111;
            padding: 0;
        }

        .swiper {
            padding: 20px;
            position: relative;
        }


        .swiper-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover
        }

        .swiper-button-prev,
        .swiper-button-next {
            opacity: 0;
            transition: opacity .3s;
            width: 30px !important;
            /* default is ~44px */
            height: 30px !important;
            font-size: 10px !important;
            /* controls the arrow icon size */
        }

        .slider-hover-left,
        .slider-hover-right {
            position: absolute;
            top: 0;
            width: 20%;
            height: 100%;
            z-index: 20;
        }

        .slider-hover-left {
            left: 0;
        }

        .slider-hover-right {
            right: 0;
        }

        .swiper:hover .swiper-button-next,
        .swiper:hover .swiper-button-prev {
            opacity: 1;
        }

        #Modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, .8);
            color: #fff;
            overflow-y: auto;
            padding: 20px;
            z-index: 20;
        }


        #Modal .content {
            background: linear-gradient(90deg, #000000, #484646);
            margin: auto;
            border-radius: 10px;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        #Modal img {
            width: 100%;
            height: 260px;
            object-fit: cover
        }

        #Modal iframe {
            width: 100%;
            height: 260px;
            border: 0;
            display: none
        }

        .movie-card {
            position: relative;
            width: 100%;
            height: 100%;
            cursor: pointer;
            overflow: hidden;
            transition: transform 0.3s;
            background: #000;
            border-radius: 10px;
        }

        .movie-card:hover {
            transform: scale(1.03);
        }

        .movie-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
        }

        .movie-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0);
            transition: .3s;
        }

        .movie-card:hover::before {
            background: rgba(0, 0, 0, 0.6);
        }

        .movie-card::after {
            content: '‚ñ∂';
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: #fff;
            opacity: 0;
            transition: .3s;
        }

        .movie-card:hover::after {
            opacity: 1;
        }

        /* Full-width hero section */
        .hero-swiper {
            width: 100%;
            height: 480px;
            /* keep same height or adjust */
            margin-top: 100px;
            position: relative;
            overflow: hidden;
        }

        .hero-swiper .swiper-pagination-bullet {
            background: #fff !important;
            opacity: 0.4 !important;
            /* dim inactive dots */
        }


        .hero-swiper .swiper-pagination-bullet-active {
            opacity: 1 !important;
            background: #00eaff !important;
            transform: scale(1.3);
            /* optional: slightly bigger */
        }


        .hero-swiper,
        .hero-swiper .swiper-wrapper,
        .hero-swiper .swiper-slide {
            width: 100% !important;
            margin: 20px 0 0 0 !important;
            padding: 0 !important;
        }


        /* Each slide */
        .hero-slide {
            width: 100%;
            height: 100%;
            position: relative;
        }

        /* HERO IMAGE */
        .hero-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: top;
            /* üî• Crop from TOP (not center) */
            filter: brightness(65%);
            /* üî• Dim the image */
        }

        /* Optional: extra gradient fade */
        .hero-slide::before {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom,
                    rgba(0, 0, 0, 0.2),
                    rgba(0, 0, 0, 0.7));
            z-index: 2;
        }

        /* HERO TEXT */
        .hero-info {
            position: absolute;
            bottom: 80px;
            left: 20px;
            max-width: 50%;
            z-index: 3;
            /* above dim */
        }


        .hero-info h1 {
            font-size: 40px;
            margin-bottom: 5px;
        }

        .hero-info p {
            font-size: 16px;
            opacity: .9;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .hero-info a {
            display: inline-block;
            background: #00eaff;
            padding: 8px 30px;
            color: #000;
            font-size: 18px;
            border-radius: 5px;
            text-decoration: none;
        }

        #query {
            width: 200px;
        }

        @media (max-width: 768px) {
            .hero-info {
                max-width: 80%;
            }

            .hero-info h1 {
                font-size: 18px;
            }

            .hero-info p {
                font-size: 14px;
                opacity: .9;
                margin-bottom: 10px;
                line-height: 1.4;
            }

            .hero-info a {
                font-size: 14px;
            }

            #query {
                width: 150px;
            }

            .HT {
                font-size: 18px;
            }

            .swiper-button-prev,
            .swiper-button-next {
                display: none;
            }

        }
    </style>
</head>

<body>

    <header style="z-index: 10;">
        <div style="display: flex; align-items: center;">
            <h1 class="HT" style="color: #fff; cursor: pointer;" onclick="window.location.href='movielibrary.html'">
                ELITES <span style="color: #00eaff;">+</span></h1>
            <nav class="Nav-Bar">
                <ul class="Nav-Menu">
                    <li class="Nav-Item"><a href="library.html" class="nav-link">Home</a></li>
                    <li class="Nav-Item"><a href="movielibrary.html" class="nav-link" style="color: #00eaff;">Movies</a>
                    </li>
                    <li class="Nav-Item"><a href="serieslibrary.html" class="nav-link">Series</a></li>
                    <li class="Nav-Item"><a id="logout" class="nav-link">Logout</a></li>
                </ul>
            </nav>
        </div>
        <div
            style="padding: 10px; width:10%; display: flex; align-items: center; justify-content: end; gap: 30px; padding: 0 10px;">
            <form style="position: relative;" id="searchForm">
                <input type="text" id="query" placeholder="Search..."
                    style="padding: 10px; border-radius: 10px; border: 1px solid #111; outline: none;">
                <span style="position: absolute; right: 15px; top: 5px;">
                    <i class="ri-search-line" style="font-size: 26px; color: #111;"></i>
                </span>
            </form>
            <div class="Hamburger">
                <span class="Bar"></span>
                <span class="Bar"></span>
                <span class="Bar"></span>
            </div>
        </div>
    </header>

    <!-- HERO SLIDER -->
    <div class="hero-swiper swiper hero-section">
        <div class="swiper-wrapper" id="heroWrapper">
            <!-- Auto filled by JS -->
        </div>

        <!-- pagination dots -->
        <div class="swiper-pagination"></div>
    </div>

    <section id="genres">

    </section>

    <div id="Modal">
        <div class="content">
            <img id="modalPoster">
            <iframe id="modalTrailer" allow="autoplay; encrypted-media"></iframe>

            <div style="padding:20px">
                <h3 id="modalTitle"></h3>
                <p id="modalOverview" style="margin:10px 0"></p>
                <div style="display: flex; width: 100%; align-items: center; gap: 10px;">
                    <a id="detailsLink"
                        style="width: 50%; text-decoration: none; display:block; text-align:center; padding:10px; background:#fff; color:#000; border-radius:10px; cursor: pointer; margin-top:10px">Play
                    </a>
                    <a id="ModalClose"
                        style="width: 50%; text-decoration: none; display:block; text-align:center; padding:10px; background:#fff; color:#000; border-radius:10px; cursor: pointer; margin-top:10px">Close</a>
                </div>
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

   
   <script>
/* =============================
      API BASE URL
============================= */
const API_BASES = "https://eliteplus.pythonanywhere.com";


/* =============================
      SINGLE DEVICE LOGIN CHECK
============================= */
async function checkAuth() {
    const token = localStorage.getItem("token");
    const user = localStorage.getItem("user");

    if (!token || !user) {
        localStorage.clear();
        window.location.href = "/";
        return;
    }

    try {
        const res = await fetch(API_BASES + "/api/check", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": token
            },
            body: JSON.stringify({ Username: user })
        });

        const data = await res.json();

        if (!data.valid) {
            localStorage.clear();
            window.location.href = "/";
        }

    } catch (err) {
        console.error("Auth error:", err);
        localStorage.clear();
        window.location.href = "/";
    }
}


/* =============================
      LOGOUT BUTTON
============================= */
document.getElementById("logout").addEventListener("click", async () => {
    const user = localStorage.getItem("user");

    await fetch(API_BASE + "/api/logout", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ Username: user })
    });

    localStorage.clear();

    // FIXED: redirect to actual login page (index.html)
    window.location.href = "/index.html"; 
    // or window.location.href = "/";
});

</script>


    <script>

        document.addEventListener("DOMContentLoaded", () => {
            // ---------- modal DOM references (add these before using modalClose/showModal/etc) ----------
            const modal = document.getElementById("Modal");
            const modalClose = document.getElementById("ModalClose");
            const modalTitle = document.getElementById("modalTitle");
            const modalPoster = document.getElementById("modalPoster");
            const modalOverview = document.getElementById("modalOverview");
            const modalTrailer = document.getElementById("modalTrailer");
            const detailsLink = document.getElementById("detailsLink");

            // ========== GLOBALS ==========
            const API_BASE = "https://eliteplus.pythonanywhere.com";
            let MOVIE_CACHE = {}; // MUST be at top before any function uses it

            // ========== SEARCH UI SETUP ==========
            const searchForm = document.getElementById("searchForm");
            const queryInput = document.getElementById("query");
            const genresContainer = document.getElementById("genres");
            const heroSection = document.querySelector(".hero-section");

            // Create search container
            let searchContainer = document.createElement("div");
            searchContainer.id = "searchContainer";
            searchContainer.style.display = "none";
            searchContainer.style.marginTop = "100px";
            searchContainer.style.padding = "10px";

            searchContainer.innerHTML = `
    <h2 id="searchTitle" style="color:#fff; margin-bottom:15px;">Search Results</h2>
    <div id="searchResults"
         style="display:grid; grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); gap:12px;">
    </div>
`;
            document.body.insertBefore(searchContainer, genresContainer);

            const searchResultsDiv = document.getElementById("searchResults");
            const searchTitle = document.getElementById("searchTitle");


            // ========== SEARCH API ==========
            async function searchMovies(q) {
                try {
                    const res = await fetch(`${API_BASE}/api/search?query=${encodeURIComponent(q)}`);
                    const data = await res.json();
                    return data.movies || [];
                } catch (e) {
                    console.error("Search error:", e);
                    return [];
                }
            }


            // ========== RENDER SEARCH RESULTS ==========
            function renderSearchResults(movies, queryText) {
                searchResultsDiv.innerHTML = "";

                searchTitle.innerHTML = `You‚Äôve searched for ‚Äú<span style="color:#0cf">${queryText}</span>‚Äù`;

                if (!movies || movies.length === 0) {
                    searchResultsDiv.innerHTML = `<p style="color:#fff;">No results found.</p>`;
                    return;
                }

                movies.forEach(m => {
                    MOVIE_CACHE[m.id] = m;

                    const card = document.createElement("div");
                    card.className = "movie-card";
                    card.style.cursor = "pointer";

                    card.innerHTML = `
            <img src="${m.poster || m.backdrop || ''}" 
                 style="width:100%;height:210px;object-fit:cover;border-radius:8px;">
            <div style="padding:6px 4px;color:#fff;font-size:14px">${m.title || m.name}</div>
        `;

                    card.addEventListener("click", () => showModal(m.id));
                    searchResultsDiv.appendChild(card);
                });
            }


            // ========== SEARCH BEHAVIOR ==========
            queryInput.addEventListener("input", async () => {
                const text = queryInput.value.trim();

                if (text.length > 0) {
                    if (heroSection) heroSection.style.display = "none";
                    genresContainer.style.display = "none";

                    searchContainer.style.display = "block";
                    searchResultsDiv.innerHTML = `<p style="color:#fff;padding:10px;">Searching...</p>`;

                    const movies = await searchMovies(text);
                    renderSearchResults(movies, text);

                } else {
                    if (heroSection) heroSection.style.display = "block";
                    genresContainer.style.display = "block";

                    searchContainer.style.display = "none";
                    searchResultsDiv.innerHTML = "";
                }
            });

            searchForm.addEventListener("submit", e => e.preventDefault());


            // ========== NAV MENU ==========
            const Hamburger = document.querySelector('.Hamburger');
            const NavMenu = document.querySelector('.Nav-Menu');

            Hamburger.addEventListener('click', () => {
                Hamburger.classList.toggle('active');
                NavMenu.classList.toggle('active');
            });

            document.querySelectorAll('.nav-link').forEach(n =>
                n.addEventListener("click", () => {
                    Hamburger.classList.remove('active');
                    NavMenu.classList.remove('active');
                })
            );


            // ========== GENRE LOADER ==========
            const GENRES = {
                28: "Action", 12: "Adventure", 16: "Animation", 35: "Comedy", 80: "Crime",
                99: "Documentary", 18: "Drama", 10751: "Family", 14: "Fantasy", 36: "History",
                27: "Horror", 10402: "Music", 9648: "Mystery", 10749: "Romance", 878: "Sci-Fi",
                53: "Thriller", 10752: "War", 37: "Western"
            };

            async function loadGenre(id, name) {
                const res = await fetch(`${API_BASE}/api/genre?genre_id=${id}`);
                const data = await res.json();
                const movies = data.movies || [];

                const section = document.createElement("div");

                movies.forEach(m => MOVIE_CACHE[m.id] = m);

                section.innerHTML = `
        <h2>${name}</h2>
        <div class="swiper swiper-${id}">
            <div class="swiper-wrapper">
                ${movies.map(m => `
                    <div class="swiper-slide" onclick="showModal(${m.id})">
                        <div class="movie-card">
                            <img src="${m.poster}">
                        </div>
                    </div>
                `).join("")}
            </div>
            <div class="swiper-button-next swiper-next-${id}"></div>
            <div class="swiper-button-prev swiper-prev-${id}"></div>
        </div>
    `;

                genresContainer.appendChild(section);

                new Swiper(`.swiper-${id}`, {
                    slidesPerView: 6,
                    spaceBetween: 10,
                    freeMode: true,
                    navigation: {
                        nextEl: `.swiper-next-${id}`,
                        prevEl: `.swiper-prev-${id}`
                    },
                    breakpoints: {
                        0: { slidesPerView: 2 },
                        500: { slidesPerView: 3 },
                        700: { slidesPerView: 4 },
                        1000: { slidesPerView: 6 }
                    }
                });
            }

            async function loadAll() {
                for (const id in GENRES) await loadGenre(id, GENRES[id]);
            }


            // ========== HERO LOADER ==========
            async function loadHero() {
                const res = await fetch(`${API_BASE}/api/latest`);
                const data = await res.json();
                const movies = data.movies.slice(0, 5);

                const wrapper = document.getElementById("heroWrapper");

                movies.forEach(m => MOVIE_CACHE[m.id] = m);

                wrapper.innerHTML = movies.map(m => `
        <div class="swiper-slide hero-slide" onclick="showModal(${m.id})">
            <img src="${m.backdrop || m.poster}">
            <div class="hero-info">
                <h1>${m.title || m.name}</h1>
                <p>${m.overview}</p>
                <a href="movie.html?id=${m.id}">Play</a>
                <a onclick="showModal(${m.id})">View Detail</a>
            </div>
        </div>
    `).join("");

                new Swiper(".hero-swiper", {
                    autoplay: { delay: 4000, disableOnInteraction: false },
                    loop: true,
                    pagination: { el: ".swiper-pagination", clickable: true }
                });
            }


            // ========== MODAL ==========
            let trailerTimeout;

            // This handles ID coming from onclick="showModal(123)"
            function showModal(id) {
                const movie = MOVIE_CACHE[id];
                if (!movie) return console.warn("Movie not found:", id);
                openModal(movie);
            }

            // This handles the actual modal display
            async function openModal(movie) {
                if (trailerTimeout) clearTimeout(trailerTimeout);

                modal.style.display = "flex";
                modalTitle.textContent = movie.title || movie.name;
                modalPoster.src = movie.backdrop || movie.poster;
                modalOverview.textContent = movie.overview;
                detailsLink.href = `movie.html?id=${movie.id}`;

                modalPoster.style.display = "block";
                modalTrailer.style.display = "none";
                modalTrailer.src = "";

                trailerTimeout = setTimeout(async () => {
                    const res = await fetch(`${API_BASE}/api/trailer?id=${movie.id}&type=movie`);
                    const data = await res.json();

                    if (data.youtube_key) {
                        modalTrailer.src =
                            `https://www.youtube.com/embed/${data.youtube_key}?autoplay=1&mute=0`;
                        modalPoster.style.display = "none";
                        modalTrailer.style.display = "block";
                    }
                }, 500);
            }

            // Close handlers
            modalClose.onclick = () => {
                modal.style.display = "none";
                modalTrailer.src = "";
            };

            window.onclick = e => {
                if (e.target === modal) {
                    modal.style.display = "none";
                    modalTrailer.src = "";
                }
            };

            // Make functions global so HTML onclick="" works
            window.showModal = showModal;



            // ========== START APP ==========
            loadHero();
            loadAll();
        });
    </script>
</body>

</html>